version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm ci
        - cd server && npm ci && cd ..
        - echo "Dependencies installed"
    build:
      commands:
        - echo "Building frontend..."
        - npm run build
        - echo "Building backend..."
        - cd server && npm run build && cd ..
        - echo "Setting up production structure..."
        - cp -r server/dist ./dist/api
        - cp -r server/node_modules ./dist/api/
        - cp -r server/data ./dist/api/ || mkdir -p ./dist/api/data
        - cp server/package.json ./dist/api/
        - echo "Build completed successfully"
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - server/node_modules/**/* 